<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">



<title>Mysql learning 1-sql基础语法 | Hexo</title>



    <link rel="icon" href="/a.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Shirley&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Shirley&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">Mysql learning 1-sql基础语法</h1>
            
                <div class="post-meta">
                    

                    
                        <span class="post-time">
                        Date: <a href="#">February 26, 2020&nbsp;&nbsp;19:16:31</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/database/">database</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h2 id="数据库相关概念"><a href="#数据库相关概念" class="headerlink" title="数据库相关概念"></a>数据库相关概念</h2><ul>
<li>DB:数据库</li>
<li>DBMS：数据库管理系统，如Mysql</li>
<li>SQL：结构化查询语言，与数据库通信的语言</li>
</ul>
<h2 id="数据库特点"><a href="#数据库特点" class="headerlink" title="数据库特点"></a>数据库特点</h2><ul>
<li>数据-表-库</li>
<li>列=字段</li>
</ul>
<h2 id="Mysql服务的启动和停止"><a href="#Mysql服务的启动和停止" class="headerlink" title="Mysql服务的启动和停止"></a>Mysql服务的启动和停止</h2><ul>
<li>计算机-右击管理-服务</li>
<li>通过管理员运行命令行<br>net start 服务名<br>net stop 服务名</li>
</ul>
<h2 id="Mysql服务的登录和退出"><a href="#Mysql服务的登录和退出" class="headerlink" title="Mysql服务的登录和退出"></a>Mysql服务的登录和退出</h2><ul>
<li>通过mysql自带的客户端，只限于root用户</li>
<li>通过windows自带客户端<br>登录：mysql [-h主机名 -P端口号] -u用户名 -p密码<br>退出：exit 或 ctrl+C</li>
</ul>
<h2 id="MYsql的常见命令"><a href="#MYsql的常见命令" class="headerlink" title="MYsql的常见命令"></a>MYsql的常见命令</h2><ul>
<li><p>查看当前所有的数据库 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br></pre></td></tr></table></figure>
</li>
<li><p>打开指定的库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use 库名;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看当前库的所有表格</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show tables;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看其他库的所有表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show tables from 库名;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table 表名（</span><br><span class="line">    列名 列类型,</span><br><span class="line">    列名 列类型,</span><br><span class="line">    ...</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看表结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc 表名;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看服务器的版本</p>
<ul>
<li><p>登录到mysql服务端</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select version();</span><br></pre></td></tr></table></figure>
</li>
<li><p>没有登录服务端</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql --version</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h2 id="mysql的语法规范"><a href="#mysql的语法规范" class="headerlink" title="mysql的语法规范"></a>mysql的语法规范</h2><ul>
<li>不区分大小写，建议关键字大写，表名列名小写</li>
<li>每条命令最好用;结尾</li>
<li>每条命令根据需要可缩进或换行</li>
<li>注释<ul>
<li>单行注释：<ul>
<li>#注释文字</li>
<li>– 注释文字</li>
</ul>
</li>
<li>多行注释：<ul>
<li>/*注释文字 */</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="DQL-Data-Query-Language-语言"><a href="#DQL-Data-Query-Language-语言" class="headerlink" title="DQL(Data Query Language)语言"></a>DQL(Data Query Language)语言</h2><h3 id="基础查询"><a href="#基础查询" class="headerlink" title="基础查询"></a>基础查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段, 字段 FROM 表;</span><br><span class="line">SELECT * FROM 表 #全部字段;</span><br><span class="line">SELECT DISTINCT 字段 FROM 表; #去重</span><br></pre></td></tr></table></figure>

<h3 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT 查询列表</span><br><span class="line">FROM 表名</span><br><span class="line">WHERE 筛选条件;</span><br></pre></td></tr></table></figure>

<p>筛选条件分类</p>
<ul>
<li><p>按条件表达式筛选</p>
<ul>
<li>简单条件运算符：&gt;, &lt;, =, !=, &lt;&gt;, &gt;=, &lt;=<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM employees</span><br><span class="line">WHERE salary&gt;12000;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>按逻辑表达式筛选</p>
<ul>
<li>逻辑运算符：&amp;&amp;, and; ||, or; !, not<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT last_name, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE salary&gt;=10000 AND salary&lt;=20000</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>模糊查询</p>
<ul>
<li>复杂条件运算符like, between and, in, is null, is not null<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM employees</span><br><span class="line">WHERE last_name LIKE &apos;%A%&apos; #通配符%任意多个字符，_任意单个字符</span><br><span class="line"></span><br><span class="line">SELECT last_name, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE salary BETWEEN 10000 AND 20000 #同大于等于小于等于</span><br><span class="line"></span><br><span class="line">SELECT last_name, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE last_name IN (&apos;a&apos;, &apos;b&apos;, &apos;c&apos;) #判断某字段的值是否属于IN列表中的某一项</span><br><span class="line"></span><br><span class="line">SELECT last_name, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE comission IS NULL #是空置的</span><br><span class="line"></span><br><span class="line">SELECT last_name, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE comission &lt;=&gt; NULL #安全等于也可以判断NULL，但可读性差</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h3 id="排序查询"><a href="#排序查询" class="headerlink" title="排序查询"></a>排序查询</h3><p>ORDER BY可以支持单个字段，多个字段，表达式，函数，别名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM emplyees</span><br><span class="line">WHERE </span><br><span class="line">ORDER BY salary DESC, employee_id ASC; #升序ASC，默认升序</span><br></pre></td></tr></table></figure>

<h3 id="常见函数"><a href="#常见函数" class="headerlink" title="常见函数"></a>常见函数</h3><h4 id="单行函数"><a href="#单行函数" class="headerlink" title="单行函数"></a>单行函数</h4><ul>
<li><p>字符函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">CONCAT(A, B) #拼接</span><br><span class="line"></span><br><span class="line">IFNULL(A, B) #如果为NULL，则显示为B</span><br><span class="line">ISNULL(A) #是NULL返回1，否则返回0</span><br><span class="line"></span><br><span class="line">LENGTH(A) #字节个数，utf8中文一个字3个字节</span><br><span class="line"></span><br><span class="line">UPPER(A) #大写</span><br><span class="line">LOWER(A) #小写</span><br><span class="line"></span><br><span class="line">SUBSTR(&apos;joh&apos;,2, 2) #索引从1开始，截取从某个索引开始的（若没有第三位，是h后面所有字符）两个字符，返回oh</span><br><span class="line"></span><br><span class="line">INSTR(&apos;joh&apos;, &apos;oh&apos;) #返回子串第一次出现的索引，如果找不到返回0</span><br><span class="line"></span><br><span class="line">TRIM(&apos;   dn &apos;) #去除前后空格</span><br><span class="line">TRIM(&apos;A&apos; FROM &apos;AAADNAA&apos;) #去除前后的A</span><br><span class="line"></span><br><span class="line">LPAD(&apos;ABA&apos;, 10, &apos;*&apos;) #指定长度左填充</span><br><span class="line">RPAD() #右填充</span><br></pre></td></tr></table></figure>
</li>
<li><p>数学函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ROUND() #四舍五入</span><br><span class="line"></span><br><span class="line">CEIL() #向上取整</span><br><span class="line"></span><br><span class="line">FLOOR() #向下取整</span><br><span class="line"></span><br><span class="line">TRUNCATE(数, 位数) #截断，保留几位，后面的都不要</span><br><span class="line"></span><br><span class="line">MOD(a, b) #取余 a-a/b*b</span><br></pre></td></tr></table></figure>
</li>
<li><p>日期函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">NOW() #当前系统日期+时间</span><br><span class="line">CURDATE() #当前日期</span><br><span class="line">CURTIME() #当前时间</span><br><span class="line">YEAR() #年</span><br><span class="line">MONTH()</span><br><span class="line">MONTHNAME()#英文月份</span><br><span class="line">STR_TO_DATE(&apos;9-13-1999&apos;, &apos;%c-%d-%Y) #将字符串转换成日期，需要指定你字符串的日期格式，输出日期标准格式；%Y四位的年份；%y2位的年份；%m月份（01，02）；%c月份（1，2）；%d日；%H24小时制；%h12小时制；%i分钟；%s秒</span><br><span class="line"></span><br><span class="line">DATE_FORMAT(NOW(), &apos;%y年%m月%d日) #将日期转换成字符</span><br></pre></td></tr></table></figure>
</li>
<li><p>其他函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">VERSION() #版本</span><br><span class="line">DATABASE() #当前数据库</span><br><span class="line">USER() #当前用户</span><br><span class="line">PASSWORD() #加密</span><br><span class="line">MD5() #加密</span><br></pre></td></tr></table></figure>
</li>
<li><p>流程控制函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">IF(10&lt;5, &apos;大&apos;, &apos;小&apos;)#if else效果</span><br><span class="line"></span><br><span class="line">CASE 要判断的字段</span><br><span class="line">WHEN 常量1 THEN 要显示的值/语句；#语句才加；</span><br><span class="line">WHEN 常量2 THEN 要显示的；</span><br><span class="line">ELSE 默认要显示的</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line">例1：</span><br><span class="line">SELECT salary 原始工资, department_id,</span><br><span class="line">CASE department_id</span><br><span class="line">WHEN 30 THEN salary*1.1</span><br><span class="line">WHEN 40 THEN salary*1.2</span><br><span class="line">ELSE salary</span><br><span class="line">END AS 新工资 #相当于表达式</span><br><span class="line">FROM employees;</span><br><span class="line"></span><br><span class="line">CASE </span><br><span class="line">WHEN 条件1 THEN 要显示的值/语句；#语句才加；</span><br><span class="line">WHEN 条件2 THEN 要显示的；</span><br><span class="line">ELSE 默认要显示的</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line">例2：</span><br><span class="line">SELECT salary,</span><br><span class="line">CASE</span><br><span class="line">WHEN salary&gt;20000 THEN &apos;A&apos;</span><br><span class="line">WHEN salary&gt;15000 THEN &apos;B&apos;</span><br><span class="line">WHEN salary&gt;10000 THEN &apos;C&apos;</span><br><span class="line">ELSE &apos;D&apos;</span><br><span class="line">END AS 工资级别</span><br><span class="line">FROM employees;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="分组函数（统计函数）"><a href="#分组函数（统计函数）" class="headerlink" title="分组函数（统计函数）"></a>分组函数（统计函数）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SUM() #求和</span><br><span class="line">AVG() #平均值</span><br><span class="line">MAX() #最大值</span><br><span class="line">MIN() #最小值</span><br><span class="line">COUNT() #计算个数，非空的</span><br></pre></td></tr></table></figure>

<p>特点</p>
<ul>
<li>SUM,AVG处理数值型，其他都可以用</li>
<li>都忽略NULL值</li>
<li>可以和DISTINCT搭配使用，如SUM(DISTINCT salary)</li>
<li>COUNT(*)统计行数，主键肯定不为NULL，所以每一行都会统计上，且效率最高<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">习题补充</span><br><span class="line">DATEDIFF(MAX(hiredate), MIN(hiredate))#返回两个日期差的日子数</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h3><p>GROUP BY子句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">SELECT column, group_function(column)</span><br><span class="line">FROM table</span><br><span class="line">WHERE condition</span><br><span class="line">GROUP BY group_by_expression</span><br><span class="line">ORDER BY column;</span><br><span class="line"></span><br><span class="line">例1</span><br><span class="line">SELECT MAX(salary), job_id</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY job_id</span><br><span class="line"></span><br><span class="line">分组后的筛选</span><br><span class="line">SELECT COUNT(*), job_id</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY job_id</span><br><span class="line">HAVING COUNT(*)&gt;2;</span><br><span class="line"></span><br><span class="line">例2</span><br><span class="line">SELECT manager_id, MIN(salary)</span><br><span class="line">FROM employees</span><br><span class="line">WHERE manager_id&gt;102</span><br><span class="line">GROUP BY nabager_id</span><br><span class="line">HAVING MIN(salary)&gt;5000;</span><br><span class="line"></span><br><span class="line">例3 </span><br><span class="line">SELECT COUNT(*) c, LENGTH(last_name) len_name</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY len_name</span><br><span class="line">HAVING c&gt;5;</span><br><span class="line"></span><br><span class="line">按多个字段分组</span><br><span class="line">SELECT AVG(salary), department_id, job_id</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id, job_id;</span><br></pre></td></tr></table></figure>

<p>特点</p>
<ul>
<li>分组前筛选 原始表 WHERE(优先）；分组后筛选 分组后的结果集 HAVING</li>
<li>支持多个字段分组，也可用表达式或函数</li>
<li>也可以添加排序，排序放最后面</li>
</ul>
<h3 id="连接查询（多表查询）"><a href="#连接查询（多表查询）" class="headerlink" title="连接查询（多表查询）"></a>连接查询（多表查询）</h3><ul>
<li><p>笛卡尔乘积现象，会使两个表的所有行连接，表1m行，表2n行，结果m*n行，此时是因为有没有加有效的连接条件</p>
</li>
<li><p>内连接(sql92)</p>
<ul>
<li><p>等值连接（交集）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT a.name, b.boyName</span><br><span class="line">FROM boys b, beauty a #为表取别名</span><br><span class="line">WHERE a.boyfirend_id=b.id</span><br><span class="line">AND a.boy IS NOT NULL;</span><br></pre></td></tr></table></figure>
</li>
<li><p>非等值连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT salary, grade_level</span><br><span class="line">FROM employees e, job_grades j</span><br><span class="line">WHERE e.salary BEWTEEN j.lowest_sal AND j.highest_sal</span><br><span class="line">AND j.grade_level = &apos;A&apos;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>自连接:一张表找两遍，比如员工找到上级领导编号，再用编号找到领导名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT e.employee_id, e.last_name, m.employee_id, m.last_name</span><br><span class="line">FROM employees e, employees m</span><br><span class="line">WHERE e.manager_id = m.employee_id</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>内连接(sql99)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT 查询列表</span><br><span class="line">FROM 表1 别名 </span><br><span class="line">【连接类型（INNER/LEFT [OUTER]/RIGHT [OUTER]/FULL [OUTER]/CROSS】JOIN 表2 别名 </span><br><span class="line">ON 连接条件</span><br><span class="line">WHERE 筛选条件</span><br><span class="line">GROUP BY 分组</span><br><span class="line">HAVING 筛选条件</span><br><span class="line">ORDER BY 排序列表</span><br></pre></td></tr></table></figure>

<ul>
<li><p>等值连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT a.name, b.boyName</span><br><span class="line">FROM boys b</span><br><span class="line">INNER JOIN beauty a </span><br><span class="line">ON a.boyfirend_id=b.id</span><br><span class="line">WHERE a.boy IS NOT NULL;</span><br></pre></td></tr></table></figure>
</li>
<li><p>非等值连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT salary, grade_level</span><br><span class="line">FROM employees e</span><br><span class="line">INNER JOIN job_grades j</span><br><span class="line">ON e.salary BEWTEEN j.lowest_sal AND j.highest_sal</span><br><span class="line">WHERE j.grade_level = &apos;A&apos;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>自连接:一张表找两遍，比如员工找到上级领导编号，再用编号找到领导名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT e.employee_id, e.last_name, m.employee_id, m.last_name</span><br><span class="line">FROM employees e</span><br><span class="line">INNER JOIN employees m</span><br><span class="line">ON e.manager_id = m.employee_id</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>外连接(sql99)<br>有主副表之分，主表有而副表没有则显示null，左外和右外可实现同样效果，左外主表在前，右外主表在后</p>
<ul>
<li><p>左外连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT d.*, e.employee_id</span><br><span class="line">FROM departments d</span><br><span class="line">LEFT OUTER JOIN employees e</span><br><span class="line">ON d.department_id = e.department_id</span><br><span class="line">WHERE e.employee_id IS NULL #查询没有员工的部门信息</span><br></pre></td></tr></table></figure>
</li>
<li><p>右外连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT d.*, e.employee_id</span><br><span class="line">FROM employees e</span><br><span class="line">RIGHT OUTER JOIN departments d</span><br><span class="line">ON d.department_id = e.department_id</span><br><span class="line">WHERE e.employee_id IS NULL</span><br></pre></td></tr></table></figure>
</li>
<li><p>全外连接（mysql不支持）<br>两张都算主表，内连接+两张表单独有的部分</p>
</li>
</ul>
</li>
<li><p>交叉连接–相当于笛卡尔乘积效果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT b.*, bo.*</span><br><span class="line">FROM beauty b</span><br><span class="line">CROSS JOIN boys bo</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><p>出现在其他语句中的SELECT语句，放在()内,子查询先于主查询</p>
<ul>
<li><p>SELECT后面：标量子查询（一行一列）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT d.*, (</span><br><span class="line">  SELECT COUNT(*)</span><br><span class="line">  FROM employees e</span><br><span class="line">  WHERE d.department_id = e.department_id</span><br><span class="line">) 个数</span><br><span class="line">FROM departments d;</span><br></pre></td></tr></table></figure>
</li>
<li><p>FROM后面：表子查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT ag_dep.*, g.grade_level</span><br><span class="line">FROM (</span><br><span class="line">  SELECT AVG(salary) ag, department_id</span><br><span class="line">  FROM employees</span><br><span class="line">  GROUP BY department_id</span><br><span class="line">) ag_dep </span><br><span class="line">INNER JOIN job_grades g</span><br><span class="line">ON ag_dep.ag BETWEEN lowest_sal AND highest_sal;</span><br></pre></td></tr></table></figure>
</li>
<li><p>WHERE或HAVING后面：</p>
<ul>
<li><p>标量子查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">SELECT last_name, job_id, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE job_id = (</span><br><span class="line">  SELECT job_id</span><br><span class="line">  FROM employees</span><br><span class="line">  WHERE employee_id = 141</span><br><span class="line">) AND salary &gt; (</span><br><span class="line">  SELECT salary</span><br><span class="line">  FROM employees</span><br><span class="line">  WHERE employee_id = 143</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">SELECT MIN(salary), department_id</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id</span><br><span class="line">HAVING MIN(salary) &gt; (</span><br><span class="line">  SELECT MIN(salary)</span><br><span class="line">  FROM employees</span><br><span class="line">  WHERE department_id = 50</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>列子查询（一列多行）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">IN/NOT IN 等于列表中的任意一个</span><br><span class="line">例1：</span><br><span class="line">SELECT last_name</span><br><span class="line">FROM eployees</span><br><span class="line">WHERE department_id IN (</span><br><span class="line">  SELECT DISTINCT department_id</span><br><span class="line">  FROM departments</span><br><span class="line">  WHERE location_id IN (1400, 1700)</span><br><span class="line">);</span><br><span class="line">ANY/SOME 和子查询返回的某一个值比较（可被替换，可读性差）</span><br><span class="line">SELECT job_id, last_name, employee_id, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE salary &lt; ANY( #可用MAX()替代</span><br><span class="line">  SELECT DISTINCT salary</span><br><span class="line">  FROM employees</span><br><span class="line">  WHERE job_id = &apos;IT_PROG&apos;</span><br><span class="line">) AND job_id &lt;&gt; &apos;IT_PROG&apos;;</span><br><span class="line"></span><br><span class="line">ALL 和子查询返回的所有值比较（可被替换，可读性差）</span><br></pre></td></tr></table></figure>
</li>
<li><p>行子查询,不常用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">例：常规查询</span><br><span class="line">SELECT *</span><br><span class="line">FROM employees</span><br><span class="line">WHERE employees_id = (</span><br><span class="line">  SELECT MIN(employee_id)</span><br><span class="line">  FROM employees</span><br><span class="line">) AND salary = (</span><br><span class="line">  SELECT MAX(salary)</span><br><span class="line">  FROM employees</span><br><span class="line">);</span><br><span class="line">行子查询</span><br><span class="line">SELECT *</span><br><span class="line">FROM employees</span><br><span class="line">WHERE employees_id, salary = (</span><br><span class="line">  SELECT MIN(employee_id), MAX(salary)</span><br><span class="line">  FROM employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>EXISTS后面（相关子查询）：表子查询；是否有值，有显示1，没有0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT department_name</span><br><span class="line">FROM departments d</span><br><span class="line">WHERE EXISTS (</span><br><span class="line">  SELECT *</span><br><span class="line">  FROM employees e</span><br><span class="line">  WHERE e.department_id = d.department_id</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h3><p>当要显示的数据一页显示不全，需要分页提交sql请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT 查询列表</span><br><span class="line">FROM 表</span><br><span class="line">【...]</span><br><span class="line">LIMIT offset, size; #offset:要显示条目的起始索引（0开始）；size：要显示的条目个数</span><br><span class="line">例：</span><br><span class="line">SELECT *</span><br><span class="line">FROM employees</span><br><span class="line">LIMIT 0, 5;</span><br></pre></td></tr></table></figure>

<h3 id="联合查询"><a href="#联合查询" class="headerlink" title="联合查询"></a>联合查询</h3><p>将多条查询语句的结果合并成一个结果，当查询结果来自多个表，但查询信息一致。会去重，用UNION ALL不去重。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">查询语句1</span><br><span class="line">UNION</span><br><span class="line">查询语句2</span><br><span class="line">UNION</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">例</span><br><span class="line">SELECT id, cname FROM t_ca WHERE csex=&apos;男&apos;</span><br><span class="line">UNION</span><br><span class="line">SELECT t_id, tname FROM t_ua WHERE tgender=&apos;male&apos;;</span><br></pre></td></tr></table></figure>

<h2 id="DML语言（数据操纵语言）"><a href="#DML语言（数据操纵语言）" class="headerlink" title="DML语言（数据操纵语言）"></a>DML语言（数据操纵语言）</h2><h3 id="插入：INSERT"><a href="#插入：INSERT" class="headerlink" title="插入：INSERT"></a>插入：INSERT</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">方式一</span><br><span class="line">INSERT INTO 表名 (列名,...) VALUES (值1,...),(值...);</span><br><span class="line">例：</span><br><span class="line">INSERT INTO beauty(id,name,sex,borndate,phone,phote,boyfriend_id)</span><br><span class="line">VALUES(13,&apos;shirley&apos;,&apos;female&apos;,&apos;1995-1-21&apos;,NULL,NULL,2);</span><br><span class="line">等价（null可以不写入）</span><br><span class="line">INSERT INTO beauty(id,name,sex,borndate,boyfriend_id)</span><br><span class="line">VALUES(13,&apos;shirley&apos;,&apos;female&apos;,&apos;1995-1-21&apos;,2);</span><br><span class="line"></span><br><span class="line">方式二：</span><br><span class="line">INSERT INTO 表名</span><br><span class="line">SET 列名=值, 列名=值,...;</span><br></pre></td></tr></table></figure>

<p>比较两种方式</p>
<ul>
<li>方式一支持插入多行</li>
<li>方式一支持子查询，可以把子查询结果集插入表中</li>
</ul>
<h3 id="修改：UPDATE"><a href="#修改：UPDATE" class="headerlink" title="修改：UPDATE"></a>修改：UPDATE</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">1.修改单表记录</span><br><span class="line">UPDATE 表名</span><br><span class="line">SET 列=新值,...</span><br><span class="line">WHERE 筛选条件；</span><br><span class="line">例：</span><br><span class="line">UPDATE beauty</span><br><span class="line">SET phone = &apos;1380000000&apos;</span><br><span class="line">WHERE name LIKE &apos;唐%&apos;;</span><br><span class="line"></span><br><span class="line">2.修改多表记录</span><br><span class="line">SQL92:</span><br><span class="line">UPDATE 表1 别名, 表2 别名</span><br><span class="line">SET 列=值,...</span><br><span class="line">WHERE 连接条件</span><br><span class="line">AND 筛选条件;</span><br><span class="line"></span><br><span class="line">SQL99:</span><br><span class="line">UPDATE 表1 别名</span><br><span class="line">INNER/LEFT/RIGHT JOIN 表2 别名 ON 连接条件</span><br><span class="line">SET 列=值,...</span><br><span class="line">WHERE 筛选条件;</span><br><span class="line">例：</span><br><span class="line">UPDATE boys bo</span><br><span class="line">RIGHT JOIN beauty b ON bo.id = b.boyfriend_id</span><br><span class="line">SET b.boyfriend_id = 2</span><br><span class="line">WHERE bo.id IS NULL;</span><br></pre></td></tr></table></figure>

<h3 id="删除：DELETE"><a href="#删除：DELETE" class="headerlink" title="删除：DELETE"></a>删除：DELETE</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">方式一：</span><br><span class="line">1.单表的删除</span><br><span class="line">DELETE FROM 表名 WHERE 筛选条件;</span><br><span class="line">例：</span><br><span class="line">DELETE FROM beauty WHERE phone LIKE &apos;%9&apos;;</span><br><span class="line"></span><br><span class="line">2.多表的删除</span><br><span class="line">sql92：</span><br><span class="line">DELETE 表1别名, 表2别名</span><br><span class="line">FROM 表1 别名, 表2 别名</span><br><span class="line">WHERE 连接条件</span><br><span class="line">AND 筛选条件;</span><br><span class="line"></span><br><span class="line">sql99：</span><br><span class="line">DELETE 表1别名, 表2别名</span><br><span class="line">FROM 表1 别名</span><br><span class="line">INNER/LEFT/RIGHT JOIN 表2 别名 ON 连接条件</span><br><span class="line">WHERE 筛选条件;</span><br><span class="line">例：</span><br><span class="line">DELETE b, bo</span><br><span class="line">FROM beauty b</span><br><span class="line">INNER JOIN boys bo ON b.boyfriend_id = bo.id</span><br><span class="line">WHERE bo.boyname = &apos;zhangwuji&apos;;</span><br><span class="line"></span><br><span class="line">方式二：清空数据，不能筛选，效率更高，没有返回值，不能回滚</span><br><span class="line">TRUNCATE TABLE 表名;</span><br></pre></td></tr></table></figure>

<p>注：如果用DELETE删除在插入，自增长列从断点开始，TRUNCATE使用后，自增长列从1开始。</p>
<h2 id="DDL-数据定义语言"><a href="#DDL-数据定义语言" class="headerlink" title="DDL(数据定义语言)"></a>DDL(数据定义语言)</h2><p>创建，修改，删除</p>
<h3 id="库的管理"><a href="#库的管理" class="headerlink" title="库的管理"></a>库的管理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.库的创建</span><br><span class="line">CREATE DATABASE [IF NOT EXISTS] 库名;</span><br><span class="line"></span><br><span class="line">2.库的修改</span><br><span class="line">更改库的字符集</span><br><span class="line">ALTER DATABASE 库名 CHARACTER SET gbk;</span><br><span class="line"></span><br><span class="line">3.库的删除</span><br><span class="line">DROP DATABASE [IF EXISTS] 库名;</span><br></pre></td></tr></table></figure>

<h3 id="表的管理"><a href="#表的管理" class="headerlink" title="表的管理"></a>表的管理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1.表的创建</span><br><span class="line">CREATE TABLE 表名(</span><br><span class="line">  列名 列的类型 【（长度） 约束】,</span><br><span class="line">  ...</span><br><span class="line">);</span><br><span class="line">DESE 表名;</span><br><span class="line"></span><br><span class="line">2.表的修改</span><br><span class="line">列名，列的类型或约束，添加删除列，表名</span><br><span class="line">ALTER TABLE 表名 CHANGE COLUMN 旧列名 新列名 类型;#改列名可以顺便修改列的类型</span><br><span class="line">ALTER TABLE 表名 MODIFY COLUMN 列名 新类型;#改列的类型</span><br><span class="line">ALTER TABLE 表名 ADD COLUMN 新列名 类型;#增加列</span><br><span class="line">ALTER TABLE 表名 DROP COLUMN 列名;#删除列</span><br><span class="line">ALTER TABLE 表名 RENAME TO 新表名;#改表名</span><br><span class="line"></span><br><span class="line">3.表的删除</span><br><span class="line">DROP TABLE IF EXISTS 表名;</span><br><span class="line"></span><br><span class="line">4.表的复制</span><br><span class="line">仅复制表的结构</span><br><span class="line">CREATE TABLE 新表 LIKE 旧表;</span><br><span class="line"></span><br><span class="line">复制表的结构和数据</span><br><span class="line">CREATE TABLE 新表 </span><br><span class="line">SELECT * FROM 旧表</span><br><span class="line"></span><br><span class="line">只复制部分数据</span><br><span class="line">CREATE TABLE 新表 </span><br><span class="line">SELECT 想要的列</span><br><span class="line">FROM 旧表</span><br><span class="line">WHERE 筛选条件</span><br></pre></td></tr></table></figure>

<h4 id="常见的数据类型"><a href="#常见的数据类型" class="headerlink" title="常见的数据类型"></a>常见的数据类型</h4><ul>
<li>数值型<ul>
<li>整数：默认有符号，若超过范围，报错，变为临界值<ul>
<li>Tinyint 1个字节 -128-127/0-255</li>
<li>Smallint 2个字节 -32768-32767</li>
<li>Mediumint 3个字节</li>
<li>Int/integer 4个字节</li>
<li>Bigint 8个字节<br>INT UNSIGNED(无符号)<br>INT(7) ZEROFILL(显示的宽度)</li>
</ul>
</li>
<li>小数<ul>
<li>浮点数:可省略m,d，m总位数（整数＋小数位数），d小数点后位数<ul>
<li>float(m,d) 4个字节</li>
<li>double(m,d) 8个字节</li>
</ul>
</li>
<li>定点数：m,d可以省略，m默认为10，d默认为0<ul>
<li>DEC(M,D)/DECIMAL(M,D) M+2字节</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>字符型<ul>
<li>较短的文本：varchar节约空间，但效率低<ul>
<li>char(m) m个字符数 固定长度 m可省略，默认为1</li>
<li>varchar(m) m个字符数 可变长度</li>
<li>binary, varbinary 较短的二进制</li>
<li>enum(‘a’,’b’,…) 枚举，只能是括号内的</li>
<li>set(‘a’,’b’,…) 集合，可以是’a,b’</li>
</ul>
</li>
<li>较长的文本<ul>
<li>text</li>
<li>blob</li>
</ul>
</li>
</ul>
</li>
<li>日期型<ul>
<li>date</li>
<li>datetime 日期加时间 8个字节 1000-9999</li>
<li>timestamp 时间戳 4个字节 1970-2038 会跟着时区更改</li>
<li>time</li>
<li>year</li>
</ul>
</li>
</ul>
<h4 id="常见约束"><a href="#常见约束" class="headerlink" title="常见约束"></a>常见约束</h4><p>用于限制表中的数据，保证数据一致性</p>
<ul>
<li>NOT NULL：非空，保证字段不能为空</li>
<li>DEFAULT：默认，保证字段有默认值</li>
<li>PRIMARY KEY：主键，唯一性且非空</li>
<li>UNIQUE：唯一性，可以为空</li>
<li>CHECK：检查约束（mysql不支持）</li>
<li>FORIEGN KEY：外键，值必须来自主表关联列的值<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">列级约束</span><br><span class="line">CREATE TABLE stuinfo(</span><br><span class="line">  id INT PRIMARY KEY,</span><br><span class="line">  stuNAME VARCHAR(20) NOT NULL,</span><br><span class="line">  seat INT UNIQUE,</span><br><span class="line">  age INT DEFAULT 18,</span><br><span class="line">  majorID INT #外键不支持列级约束</span><br><span class="line">);</span><br><span class="line">CREATE TABLE major(</span><br><span class="line">  id INT PRIMARY KEY,</span><br><span class="line">  majorname VARCHAR(20)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">ALTER TABLE stuinfo MODIFY COLUMN stuNAME VARCHAR(20) NOT NULL;</span><br><span class="line">修改删除约束</span><br><span class="line">ALTER TABLE stuinfo MODIFY COLUMN stuNAME VARCHAR(20);</span><br><span class="line">ALTER TABLE stuinfo DROP PRIMARY KEY;</span><br><span class="line">ALTER TABLE stuinfo DROP INDEXT seat;</span><br><span class="line">表级约束</span><br><span class="line">CREATE TABLE stuinfo(</span><br><span class="line">  id INT PRIMARY KEY,</span><br><span class="line">  stuNAME VARCHAR(20),</span><br><span class="line">  seat INT,</span><br><span class="line">  age INT,</span><br><span class="line">  majorID INT,</span><br><span class="line"></span><br><span class="line">  CONSTRAINT pk PRIMARY KEY(id),</span><br><span class="line">  CONSTRAINT uq UNIQUE(seat),</span><br><span class="line">  CONSTRAINT fk FOREIGN KEY(majorid) REFERENCES major(id)</span><br><span class="line">  [CONSTRAINT 约束名] 约束类型(字段名)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">ALTER TABLE stuinfo ADD CONSTRAINT fk FOREIGN KEY(majorid) REFERENCES major(id);</span><br><span class="line">修改删除约束</span><br><span class="line">ALTER TABLE stuinfo DROP FOREIGN KEY fk;</span><br><span class="line">通用写法外键写在表级约束，其他写在列级约束</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="标识列（自增长列）"><a href="#标识列（自增长列）" class="headerlink" title="标识列（自增长列）"></a>标识列（自增长列）</h4><p>起始为1，默认步长为1，数值型。<br>唯一键（所有KEY）可以加标识，一个表只能有1给标识列。<br>SET AUTO_INCREMENT_INCREMENT=3可修改步长</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">创建表时设置标识列</span><br><span class="line">CREATE TABLE stuinfo(</span><br><span class="line">  id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">  stuNAME VARCHAR(20)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="TCL-transaction-control-language-事务控制语言"><a href="#TCL-transaction-control-language-事务控制语言" class="headerlink" title="TCL(transaction control language)事务控制语言"></a>TCL(transaction control language)事务控制语言</h2><p>事务由单独单元的一个或多个sql语句组成，在这个单元中，每个mysql语句是相互依赖的。如果一条执行失败，整个单元回滚，回到初始状态。<br>存储引擎innodb支持事务。    </p>
<h4 id="事务属性ACID"><a href="#事务属性ACID" class="headerlink" title="事务属性ACID"></a>事务属性ACID</h4><ul>
<li>原子性（atomicity）：不可分割</li>
<li>一致性（consistency）：从一个一致性状态变换到另一个一致性状态（如金额总数不变）</li>
<li>隔离性（isolation）：不能被其他事务干扰（看隔离级别）</li>
<li>持久性（durability）；事务一旦提交，就永久性改变数据库数据</li>
</ul>
<h3 id="事务创建"><a href="#事务创建" class="headerlink" title="事务创建"></a>事务创建</h3><ul>
<li><p>隐式事务：没有明显的开始结束标记</p>
<ul>
<li>insert，update，delete</li>
</ul>
</li>
<li><p>显示事务：有开始结束标记，前提设置自动提交功能为禁用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SET AUTOCOMMIT = 0; #开启事务</span><br><span class="line">START TRANSACTION; # 可省略</span><br><span class="line">#事务语句</span><br><span class="line">UPDATE account SET balance = 500 WHERE username = &apos;张无忌&apos;;</span><br><span class="line">SAVEPOINT a; #设置保存点，可搭配rollback使用</span><br><span class="line">UPDATE account SET balance = 1500 WHERE username = &apos;赵敏&apos;;</span><br><span class="line">#结束事务</span><br><span class="line">COMMIT;</span><br><span class="line">ROLLBACK; #在没结束事务之前可以回滚</span><br><span class="line">ROLLBACK TO a;</span><br></pre></td></tr></table></figure>
</li>
<li><p>DELETE可以回滚，TRUNCATE不能回滚，执行了就清除所有数据了</p>
</li>
</ul>
<h4 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h4><p>防止并发事务导致的幻读（针对插入，另一个事务对这个表插入数据，这个事务前后会发现不一样行数数据），不可重复读（在另一个事务没提交读到的和另一个事务提交后读到的不一样），脏读（读到未提交事务的数据，但未提交的事务还可以回滚）问题。</p>
<ul>
<li>READ UNCOMMITTED(读未提交数据)：脏读，不可重复读，幻读</li>
<li>READ COMMITED（读已提交数据）：不可重复读，幻读</li>
<li>REPEATEABLE READ(可重复读)：幻读</li>
<li>SERIALIZABLE(串行化)：禁止其他事务对该表执行任何数据操作，但性能低下<br>默认REPEATABLE READ<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">查看当前的隔离级别</span><br><span class="line">SELECT @@tx_isolation;</span><br><span class="line">设置当前MySQL连接的隔离级别</span><br><span class="line">SET TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line">设置数据库系统的全局隔离级别</span><br><span class="line">SET GLOBAL TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>虚拟表，临时的，每次使用动态生成这个表，只保存了sql逻辑<br>当多个地方用到同样的查询结果，该查询结果使用的sql语句较复杂，就可以用视图将这些语句封装起来，后期调用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">创建视图</span><br><span class="line">CREATE VIEW v1</span><br><span class="line">AS</span><br><span class="line">SELECT studentname, majorname</span><br><span class="line">FROM student s</span><br><span class="line">INNER JOIN major m</span><br><span class="line">ON s.majorid = m.majorid</span><br><span class="line">WHERE s.majorid = 1;</span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM v1;</span><br><span class="line"></span><br><span class="line">修改视图</span><br><span class="line">CREATE OR REPLACE VIEW 视图名</span><br><span class="line">AS</span><br><span class="line">查询语句;</span><br><span class="line">或者：</span><br><span class="line">ALTER VIEW 视图名</span><br><span class="line">AS</span><br><span class="line">查询语句;</span><br><span class="line"></span><br><span class="line">删除视图</span><br><span class="line">DROP VIEW 视图名1, 视图名2...;</span><br><span class="line"></span><br><span class="line">查看视图</span><br><span class="line">DESC 视图名;</span><br><span class="line">SHOW CREATE VIEW 视图名;</span><br><span class="line"></span><br><span class="line">修改视图：</span><br><span class="line">INSERT, UPDATE, DELETE都会在原始表更改</span><br><span class="line">某些视图不能更新，所以不怎么用更新视图</span><br></pre></td></tr></table></figure>

<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><ul>
<li><p>系统变量：服务器层面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SHOW GLOBAL/[SESSION] VARIABLES;</span><br><span class="line">SHOW GLOBAL/[SESSION] VARIABLES LIKE &apos;%char%&apos;;</span><br><span class="line">SELECT @@GLOBAL/[SESSION].系统变量名;</span><br><span class="line">SET GLOBAL/[SESSION] 系统变量名=值;</span><br><span class="line">SELECT @@GLOBAL/[SESSION].系统变量名=值;</span><br></pre></td></tr></table></figure>

<ul>
<li>全局变量：针对所有会话有效，重启后回到初始</li>
<li>会话变量：仅对当前会话有效</li>
</ul>
</li>
<li><p>自定义变量</p>
<ul>
<li><p>用户变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SET @用户变量名 := 值;</span><br><span class="line">SELECT @用户变量名 := 值;</span><br><span class="line">SELECT 字段（COUNT(*) INTO @变量名 FROM 表;</span><br><span class="line">SELECT @变量名;</span><br></pre></td></tr></table></figure>
</li>
<li><p>局部变量：仅在begin和end中第一句有效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">声明</span><br><span class="line">DECLARE 变量名 类型 [DEFAULT 值];</span><br><span class="line">SET 局部变量名 := 值;</span><br><span class="line">SELECT @局部变量名 := 值;</span><br><span class="line">SELECT 字段（COUNT(*) INTO 局部变量名 FROM 表;</span><br><span class="line">SELECT 变量名;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h2 id="存储过程和函数"><a href="#存储过程和函数" class="headerlink" title="存储过程和函数"></a>存储过程和函数</h2><h3 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h3><ul>
<li><p>一组预先编译好的SQL语句集合</p>
</li>
<li><p>提高代码重用性</p>
</li>
<li><p>简化操作</p>
</li>
<li><p>减少了编译次数和数据库服务器的连接次数，提高了效率</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">创建</span><br><span class="line">CREATE PROCEDURE 存储过程名(参数列表)</span><br><span class="line">BEGIN</span><br><span class="line">    存储过程体（一组合法的SQL语句）</span><br><span class="line">END</span><br><span class="line">参数列表：参数模式，参数名，参数类型</span><br><span class="line">参数模式:</span><br><span class="line">IN:参数可作为输入，需要调用方传入值</span><br><span class="line">OUT：可作为返回值</span><br><span class="line">INOUT：既可以作为输入，也可作为输出</span><br><span class="line"></span><br><span class="line">调用</span><br><span class="line">CALL 存储过程名(实参列表);</span><br></pre></td></tr></table></figure>
</li>
<li><p>若存储过程体仅一句话，BEGIN,END 可以省略</p>
</li>
<li><p>存储过程体每条SQL语句都要求必须加分号</p>
</li>
<li><p>存储过程的结尾可以使用DELIMITER设置 DELIMITER 结束标记</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">例：</span><br><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE test(IN id INT, OUT name VARCHAR(20), OUT phone VARCHAR(20))</span><br><span class="line">BEGIN</span><br><span class="line">    SELECT b.name, b.phone INTO name, phone</span><br><span class="line">    FROM beauty b</span><br><span class="line">    WHERE b.id = id;</span><br><span class="line">END $</span><br><span class="line">CALL test(1, @n, @p)$</span><br><span class="line">SELECT @n, @p $</span><br><span class="line"></span><br><span class="line">删除</span><br><span class="line">DROP PROCEDURE test；</span><br><span class="line">查看存储过程信息</span><br><span class="line">SHOW CREATE PROCEDURE test;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>函数只有1个返回</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">创建语法</span><br><span class="line">CREATE FUNCTION 函数名(参数列表) RETURNS 返回类型</span><br><span class="line">BEGIN</span><br><span class="line">    函数体</span><br><span class="line">    RETURN  值</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line">例：</span><br><span class="line">CREATE FUNCTION test(deptName VARCHAR(20)) RETURNS DOUBLE</span><br><span class="line">BEGIN</span><br><span class="line">    DECLARE sal DOUBLE;</span><br><span class="line">    SELECT AVG(salary) INTO sal</span><br><span class="line">    FROM employees e</span><br><span class="line">    JOIN departments d ON e.department_id = d.department_id</span><br><span class="line">    WHERE d.department_name = deptName;</span><br><span class="line">    RETURN sal;</span><br><span class="line">END$</span><br><span class="line">SELECT test(&apos;IT&apos;)$</span><br></pre></td></tr></table></figure>

<h3 id="分支语句"><a href="#分支语句" class="headerlink" title="分支语句"></a>分支语句</h3><p>作为独立语句只能放在BEGIN END中</p>
<pre><code>CREATE PROCEDURE test(IN score INT)
BEGIN
    CASE
    WHER score BETWEEN 90 AND 100</code></pre>
        </div>

        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/mysql/"># mysql</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2020/03/26/LIME-SHAP/">LIME&SHAP</a>
            
            
            <a class="next" rel="next" href="/2019/11/08/tagging-problem/">Tagging problem, and HMMs</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Shirley | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
